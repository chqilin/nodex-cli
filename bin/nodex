#!/usr/bin/env node

const program = require('commander')
const chalk = require('chalk')
const path = require('path')
const logger = require('../lib/logger')
const fs = require('fs-extra')
const TEMPLATES_PATH = path.join(__dirname, '../templates')

program.version(require('../package').version, '-v, --version')
    .usage('<command> [options]')

program
    .command('init <project>')
    .description('init a new project')
    .action((project) => {
        const dest = path.resolve(project)
        if (fs.pathExistsSync(dest)) {
            logger.fatal(`dest directory ${project} is not empty`)
            return
        }
        fs.ensureDir(dest).then(() => {
            fs.copySync(TEMPLATES_PATH, dest)
            logger.success(`✨ Successfully created ${project}`)
            logger.success(`⚙ Get started with the following commands:`)
            logger.success()
            logger.success(`$ cd ${project}`)
            logger.success(`$ npm install`)
        })
    })

program.on('command:*', function () {
    console.error(chalk.red('Invalid command: %s \nSee --help for a list of available commands.'), program.args.join(' '))
    process.exit(1)
})

program.parse(process.argv)
